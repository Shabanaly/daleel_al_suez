-- Function to handle new user welcome notification
create or replace function public.handle_new_user_welcome()
returns trigger as $$
begin
  insert into public.notifications (user_id, type, title, message, link, is_read)
  values (
    new.id,
    'welcome',
    'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙŠØ³! ğŸ‰',
    'Ø³Ø¹Ø¯Ø§Ø¡ Ø¨Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„ÙŠÙ†Ø§. Ø§Ø³ØªÙƒØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª ÙÙŠ Ù…Ø¯ÙŠÙ†ØªÙƒ.',
    '/profile',
    false
  );
  return new;
end;
$$ language plpgsql security definer;

-- Trigger to call the function on new user creation
create or replace trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user_welcome();
